(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{366:function(e,t,a){"use strict";a.r(t);var n=a(32),s=Object(n.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"uefi-secure-boot-support"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uefi-secure-boot-support","aria-hidden":"true"}},[e._v("#")]),e._v(" UEFI Secure Boot Support")]),e._v(" "),a("div",{staticClass:"danger custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("Note")]),a("p",[e._v("The feature is in an early stage of adoption and not all distributions could be supported.")])]),a("p",[e._v("This new functionality lets KernelCare work on systems with secure boot set up in their UEFI firmware. We are going to add a public certificate to the MOK (Machine Owner Keys) database that KernelCare will use to sign modules.")]),e._v(" "),a("p",[e._v("The latest KernelCare package contains a public certificate and will be available in the "),a("code",[e._v("/usr/libexec/kcare/kernelcare_pub.der")]),e._v(". For older versions, it could be downloaded from the "),a("a",{attrs:{href:"https://patches.kernelcare.com/kernelcare_pub.der",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://patches.kernelcare.com/kernelcare_pub.der"),a("OutboundLink")],1),e._v(" to that location.")]),e._v(" "),a("p",[e._v("For example:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" -o /usr/libexec/kcare/kernelcare_pub.der https://patches.kernelcare.com/kernelcare_pub.der\n\n")])])]),a("ol",[a("li",[e._v("Use "),a("code",[e._v("mokutil")]),e._v(" as root to add this new MOK to the UEFI firmware.")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ mokutil --import /usr/libexec/kcare/kernelcare_pub.der\n input password:\n input password again:\n")])])]),a("p",[e._v("It doesn't have a MOK password, and "),a("code",[e._v("mokutil")]),e._v(" will ask you to create one. The password is temporary and will be used on the next boot.")]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Reboot your machine to enter the MOK manager EFI utility.")])]),e._v(" "),a("p",[e._v("First, go down to the 'Enroll Mok':")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/uefi-enroll-mok.png",alt:""}})]),e._v(" "),a("p",[e._v("Then the firmware gives you the option of viewing the new MOK or continuing. Let's continue.")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/uefi-continue.png",alt:""}})]),e._v(" "),a("p",[e._v("It then asks you to confirm the enrollment.")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/uefi-yes.png",alt:""}})]),e._v(" "),a("p",[e._v("Then enter the password you used when running the "),a("code",[e._v("mokutil --import")]),e._v(".")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/uefi-password.png",alt:""}})]),e._v(" "),a("p",[e._v("Finally, the firmware will ask you to reboot.")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/uefi-ok.png",alt:""}})]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Verify the key has been loaded by finding it in the output of the following command:")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ mokutil --list-enrolled "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("egrep")]),e._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'SHA1|Issuer'")]),e._v("\n\n")])])]),a("p",[e._v("In some cases an enrolled key will not be shown but could be verified by following command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("dmesg")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" -i "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'cloud linux'")]),e._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("   0.722149"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" EFI: Loaded cert "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Cloud Linux Software, Inc: Kernel Module Signing Key: 12ff0613c0f80cfba3b2f8eba71ebc27c5a76170'")]),e._v(" linked to "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'.system_keyring'")]),e._v("\n")])])]),a("p",[e._v("That's it. Now you should be able to apply patches as usual.")]),e._v(" "),a("p",[e._v("To get more information about signing kernel modules for secure boot, see\n"),a("a",{attrs:{href:"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/signing-kernel-modules-for-secure-boot_managing-monitoring-and-updating-the-kernel",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/managing_monitoring_and_updating_the_kernel/signing-kernel-modules-for-secure-boot_managing-monitoring-and-updating-the-kernel"),a("OutboundLink")],1),e._v(".")])])},[],!1,null,null,null);t.default=s.exports}}]);