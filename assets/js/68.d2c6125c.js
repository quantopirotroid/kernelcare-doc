(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{360:function(e,t,a){"use strict";a.r(t);var s=a(32),r=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"scanner-interface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scanner-interface","aria-hidden":"true"}},[e._v("#")]),e._v(" Scanner Interface")]),e._v(" "),a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("WARNING")]),a("p",[e._v("Scanner Interface is only available for KernelCare+ and KernelCare Enterprise")])]),a("h2",{attrs:{id:"issue-description"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#issue-description","aria-hidden":"true"}},[e._v("#")]),e._v(" Issue description")]),e._v(" "),a("p",[e._v("Commonly used security scanners can still see CVEs even if they are patched by KernelCare. It turns out that all their decisions about CVE are based on:")]),e._v(" "),a("ul",[a("li",[e._v("currently installed (or not) kernel packages")]),e._v(" "),a("li",[e._v("uname information")])]),e._v(" "),a("h2",{attrs:{id:"how-does-it-work"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-does-it-work","aria-hidden":"true"}},[e._v("#")]),e._v(" How does it work")]),e._v(" "),a("p",[e._v("To calm them down, we can manipulate with that information and the common part for DEB and RPM distributions relying on "),a("code",[e._v("uname -r")]),e._v(" output.")]),e._v(" "),a("p",[e._v("Since scanners on RPM distributions relies on "),a("code",[e._v("rpm -q")]),e._v(" output, we can override some functions there via "),a("code",[e._v("LD_PRELOAD")]),e._v(" and force the script to output versions we need.")]),e._v(" "),a("p",[e._v("To deal with it, we will reload "),a("code",[e._v("showQueryPackage")]),e._v(" to patch version information on the fly. It will change the information showing in rpm query results like this.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[centos@ip-172-31-6-166 ~]$ rpm -q kernel-headers\nkernel-headers-3.10.0-693.17.1.el7.x86_64\n[centos@ip-172-31-6-166 ~]$ LD_PRELOAD=/usr/libexec/kcare/kpatch_package.so rpm -q\nkernel-headers-3.10.0-957.21.3.el7.x86_64\n")])])]),a("p",[e._v("The reloaded functions rely on "),a("code",[e._v("kcarectl --uname")]),e._v(" and replace the actual kernel version with our “effective version”.\nThat behavior is enabled only for one user and will not interfere with others. That user should be used to run a credentialed scan over SSH.")]),e._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation","aria-hidden":"true"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),a("p",[e._v("All you need to do on target systems is to install/update KernelCare agent with the provided package.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("KCARE_SCANNER_USER=username yum -y localinstall ./kernelcare-package.rpm\n")])])]),a("p",[e._v("Or update an existing package:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("KCARE_SCANNER_USER=username yum update kernelcare\n")])])]),a("p",[e._v("Or install:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("curl -s -L https://kernelcare.com/installer | KCARE_SCANNER_USER=username bash\n")])])]),a("p",[e._v("Where "),a("code",[e._v("username")]),e._v(" is the user which will be used to run scanners on the server.\nAfter applying KernelCare patches ("),a("code",[e._v("kcarectl --update")]),e._v(") you will see rpm query result according to a kernel that the patches are provided.")]),e._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("Note")]),a("p",[e._v("To see results, you should re-login to the server with "),a("code",[e._v("KCARE_SCANNER_USER")]),e._v(" defined above.")])]),a("div",{staticClass:"danger custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("Warning")]),a("p",[a("em",[e._v("username")]),e._v(" should be equal to the user name that is used by the security scanner to log in to the system. KernelCare agent should be actually installed with "),a("code",[e._v("KCARE_SCANNER_USER")]),e._v(" defined for Scanner Interface to operate properly (setting the variable at the run time is not enough).")])]),a("h2",{attrs:{id:"how-to-use"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-use","aria-hidden":"true"}},[e._v("#")]),e._v(" How to use")]),e._v(" "),a("p",[e._v("It’s rather simple. New scan results after installing a package and applying a patchset should not show any kernel CVEs that are handled by KernelCare.")]),e._v(" "),a("p",[e._v("For example, Nessus for an old kernel shows a bunch of detected CVEs")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/scanner-manipulation-before.png",alt:""}})]),e._v(" "),a("p",[e._v("After patches were applied, there are no kernel-related CVEs")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/scanner-manipulation-after.png",alt:""}})]),e._v(" "),a("h2",{attrs:{id:"troubleshooting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting","aria-hidden":"true"}},[e._v("#")]),e._v(" Troubleshooting")]),e._v(" "),a("p",[e._v("Checking whether "),a("code",[e._v("LD_PRELOAD")]),e._v(" is properly defined for the local security scanner agent (we use Qualys for this example).")]),e._v(" "),a("ul",[a("li",[e._v("Obtain the scanner agent PID:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ps -aux | grep qualys\n")])])]),a("ul",[a("li",[e._v("The output for the PID obtained above should contain LD_PRELOAD:")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("cat /proc/PID/environ\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("Note")]),a("p",[e._v("Qualys scanner agent is usually run as "),a("em",[e._v("root")]),e._v(", so make sure KernelCare agent is installed with KCARE_SCANNER_USER=root")])])])},[],!1,null,null,null);t.default=r.exports}}]);